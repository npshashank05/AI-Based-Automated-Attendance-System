<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Attendance System</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- Loading Screen -->
  <div id="loading-screen" class="loading-screen">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- Login Page -->
  <div id="login-page" class="login-bg" style="display:none;">
    <!-- Shooting stars -->
    <div class="star s1"></div>
    <div class="star s2"></div>
    <div class="star s3"></div>
    <div class="star s4"></div>
    <div class="star s5"></div>

    <div class="login-card">
      <!-- Card banner: CSS night desert scene -->
      <div class="login-banner">
        <!-- Moon -->
        <div class="moon"></div>
        <!-- Stars in banner -->
        <div class="b-star bs1"></div>
        <div class="b-star bs2"></div>
        <div class="b-star bs3"></div>
        <div class="b-star bs4"></div>
        <div class="b-star bs5"></div>
        <div class="b-star bs6"></div>
        <!-- Shooting stars in banner -->
        <div class="b-shoot bsh1"></div>
        <div class="b-shoot bsh2"></div>
        <!-- Dunes -->
        <div class="dune dune1"></div>
        <div class="dune dune2"></div>
        <div class="dune dune3"></div>
      </div>

      <!-- Card body -->
      <div class="login-body">
        <h1 class="login-title">Login</h1>
        <form id="login-form">
          <!-- Username / Email -->
          <div class="lf-group">
            <span class="lf-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            </span>
            <input type="email" id="login-email" placeholder="Username" required autocomplete="username" />
          </div>
          <!-- Password -->
          <div class="lf-group">
            <span class="lf-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            </span>
            <input type="password" id="login-password" placeholder="Password" required autocomplete="current-password" />
          </div>
          <!-- Remember me + forgot -->
          <div class="lf-options">
            <label class="lf-toggle">
              <input type="checkbox" id="remember-me" />
              <span class="lf-toggle-track">
                <span class="lf-toggle-thumb"></span>
              </span>
              <span class="lf-remember-text">remember me</span>
            </label>
            <a href="#" class="lf-forgot">forgot password</a>
          </div>
          <p id="login-error" class="error-msg" style="display:none;"></p>
          <button type="submit" class="lf-submit" id="login-btn">Login</button>
        </form>
        <p class="lf-create"><a href="#">Create Account</a></p>
      </div>
    </div>
  </div>

  <!-- Admin Dashboard -->
  <div id="admin-page" class="page" style="display:none;">
    <nav class="navbar">
      <span class="navbar-brand">AI Attendance — Admin</span>
      <div class="navbar-actions">
        <span class="navbar-user" id="admin-email"></span>
        <button class="btn btn-ghost btn-sm" id="admin-logout">Logout</button>
      </div>
    </nav>
    <div class="content">
      <div class="tabs">
        <button class="tab active" data-tab="students">Students</button>
        <button class="tab" data-tab="branches">Branches</button>
        <button class="tab" data-tab="attendance">Mark Attendance</button>
        <button class="tab" data-tab="logs">Logs</button>
      </div>

      <!-- Students Tab -->
      <div class="card tab-content" id="tab-students">
        <div class="card-header">
          <h2 class="card-title">Students (<span id="student-count">0</span>)</h2>
          <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
            <select id="branch-filter" class="branch-filter-select">
              <option value="">All Branches</option>
              <option>CS</option>
              <option>CS-AIML</option>
              <option>CS-DS</option>
              <option>CS-D</option>
              <option>CS-CY</option>
              <option>EC</option>
              <option>EEE</option>
              <option>CE</option>
              <option>ME</option>
            </select>
            <select id="sem-filter" class="branch-filter-select">
              <option value="">All Sems</option>
              <option value="1">Sem 1</option>
              <option value="2">Sem 2</option>
              <option value="3">Sem 3</option>
              <option value="4">Sem 4</option>
              <option value="5">Sem 5</option>
              <option value="6">Sem 6</option>
              <option value="7">Sem 7</option>
            </select>
            <button class="btn btn-primary btn-sm" id="enroll-btn">+ Enroll Student</button>
          </div>
        </div>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Name</th><th>Roll No</th><th>Branch</th><th>Sem</th><th>Email</th><th>Actions</th></tr></thead>
            <tbody id="students-tbody">
              <tr><td colspan="6" style="color:var(--text-muted);text-align:center;padding:24px;">Loading…</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Branches Tab -->
      <div class="tab-content" id="tab-branches" style="display:none;">
        <div class="branches-grid" id="branches-grid"></div>
      </div>

      <!-- Attendance Tab -->
      <div class="card tab-content" id="tab-attendance" style="display:none;">
        <div class="card-header">
          <h2 class="card-title">Mark Attendance</h2>
        </div>
        <form id="attendance-form" style="max-width:480px;">
          <div class="form-group">
            <label>Branch</label>
            <select id="att-branch">
              <option value="">All Branches</option>
              <option>CS</option>
              <option>CS-AIML</option>
              <option>CS-DS</option>
              <option>CS-D</option>
              <option>CS-CY</option>
              <option>EC</option>
              <option>EEE</option>
              <option>CE</option>
              <option>ME</option>
            </select>
          </div>
          <div class="form-group">
            <label>Semester</label>
            <select id="att-sem">
              <option value="">All Semesters</option>
              <option value="1">Sem 1</option>
              <option value="2">Sem 2</option>
              <option value="3">Sem 3</option>
              <option value="4">Sem 4</option>
              <option value="5">Sem 5</option>
              <option value="6">Sem 6</option>
              <option value="7">Sem 7</option>
            </select>
          </div>
          <div class="form-group">
            <label>Subject <span style="color:var(--danger);">*</span></label>
            <select id="att-subject" required>
              <option value="">-- Select Branch &amp; Sem first --</option>
            </select>
          </div>
          <div class="form-group">
            <label>Date</label>
            <input type="date" id="att-date" required />
          </div>
          <div class="form-group">
            <label>Group Photo</label>
            <input type="file" id="att-photo" accept="image/*" required />
          </div>
          <p id="att-error" class="error-msg" style="display:none;"></p>
          <button type="submit" class="btn btn-primary" id="att-submit" style="margin-top:8px;">Mark Attendance</button>
        </form>
        <div id="att-result" style="margin-top:28px;"></div>
      </div>

      <!-- Logs Tab -->
      <div class="card tab-content" id="tab-logs" style="display:none;">
        <div class="card-header">
          <h2 class="card-title">Attendance Logs</h2>
          <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
            <select id="log-filter-subject" class="branch-filter-select" style="min-width:160px;">
              <option value="">All Subjects</option>
            </select>
            <input type="date" class="branch-filter-select" id="log-filter-date" style="cursor:pointer;" />
          </div>
        </div>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Date</th><th>Subject</th><th>Name</th><th>Roll No</th><th>Confidence</th></tr></thead>
            <tbody id="logs-tbody">
              <tr><td colspan="5" style="color:var(--text-muted);text-align:center;padding:24px;">Loading…</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Student Dashboard -->
  <div id="student-page" class="page" style="display:none;">
    <nav class="navbar">
      <span class="navbar-brand">AI Attendance — Student</span>
      <div class="navbar-actions">
        <span class="navbar-user" id="student-email"></span>
        <button class="btn btn-ghost btn-sm" id="student-logout">Logout</button>
      </div>
    </nav>
    <div class="content">
      <!-- Profile stat cards -->
      <div class="stats-grid" id="student-stats"></div>

      <!-- Subject-wise attendance cards -->
      <div class="card" id="subject-stats-section">
        <div class="card-header">
          <h2 class="card-title">Subject-wise Attendance</h2>
          <span id="student-attendance-badge"></span>
        </div>
        <div id="subject-stats-grid" class="subj-grid"></div>
      </div>

      <!-- Detail attendance log -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Attendance Log</h2>
        </div>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Date</th><th>Subject</th><th>Status</th><th>Marked At</th></tr></thead>
            <tbody id="student-records-tbody">
              <tr><td colspan="4" style="color:var(--text-muted);text-align:center;padding:24px;">Loading…</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Enroll Modal -->
  <div id="enroll-modal" class="modal-overlay" style="display:none;">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Enroll New Student</h2>
        <button class="modal-close" id="enroll-close">&times;</button>
      </div>
      <form id="enroll-form">
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" id="enroll-name" required />
        </div>
        <div class="form-group">
          <label>Roll Number</label>
          <input type="text" id="enroll-roll" required />
        </div>
        <div class="form-group">
          <label>Branch</label>
          <select id="enroll-branch" required>
            <option value="">-- Select Branch --</option>
            <option>CS</option>
            <option>CS-AIML</option>
            <option>CS-DS</option>
            <option>CS-D</option>
            <option>CS-CY</option>
            <option>EC</option>
            <option>EEE</option>
            <option>CE</option>
            <option>ME</option>
          </select>
        </div>
        <div class="form-group">
          <label>Semester</label>
          <select id="enroll-sem" required>
            <option value="">-- Select Semester --</option>
            <option value="1">Semester 1</option>
            <option value="2">Semester 2</option>
            <option value="3">Semester 3</option>
            <option value="4">Semester 4</option>
            <option value="5">Semester 5</option>
            <option value="6">Semester 6</option>
            <option value="7">Semester 7</option>
          </select>
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="enroll-email" required />
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="enroll-password" required />
        </div>
        <div class="form-group">
          <label>Face Photo (clear, front-facing)</label>
          <input type="file" id="enroll-photo" accept="image/*" required />
        </div>
        <p id="enroll-error" class="error-msg" style="display:none;"></p>
        <div class="modal-footer">
          <button type="button" class="btn btn-ghost" id="enroll-cancel">Cancel</button>
          <button type="submit" class="btn btn-primary" id="enroll-submit">Enroll Student</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Firebase SDK (compat mode, loaded from CDN — no npm needed) -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="app.js"></script>
</body>
</html>
